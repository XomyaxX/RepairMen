<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRY6KMZf4V6FC_dXc6yPEi1Yt1e267LVIC8Ewsm4IMTtEtwNOAeBEnrNsl-TWArKAylzdy6AipcUDf3/pub?output=csv";

// Получаем параметр типа техники
const urlParams = new URLSearchParams(window.location.search);
const selectedType = urlParams.get("type");

async function loadMasters() {
    try {
        const response = await fetch(SHEET_URL);
        let csv = await response.text();
        csv = csv.replace(/\r/g, ""); // удаляем carriage return
        const rows = csv.split("\n").map(r => r.split(","));

        const headers = rows[0].map(h => h.trim());
        const data = rows.slice(1);

        const mastersContainer = document.getElementById("masters");
        mastersContainer.innerHTML = "";

        data.forEach((row, i) => {
            const master = {};
            headers.forEach((h, j) => master[h] = row[j]?.trim());

            // фильтрация по типу
            if (selectedType && master["Категория"] !== selectedType) return;

            const card = document.createElement("div");
            card.className = "master-card reveal";
            card.innerHTML = `
                <img class="master-photo" src="${master["Фото"] || 'https://via.placeholder.com/150'}" alt="Фото мастера" />
                <div class="master-name">${master["ФИО"]}</div>
                <div class="master-exp">Опыт: ${master["Опыт"]}</div>
                <a class="master-phone" href="tel:${master["Телефон"]}">Позвонить: ${master["Телефон"]}</a>
            `;

            mastersContainer.appendChild(card);

            setTimeout(() => card.classList.add("visible"), 100 * i);
        });
    } catch (e) {
        console.error("Ошибка загрузки мастеров:", e);
    }
}

loadMasters();

// Scroll reveal
const revealCards = () => {
    document.querySelectorAll('.master-card').forEach(card => {
        const rect = card.getBoundingClientRect();
        if (rect.top < window.innerHeight - 50) {
            card.classList.add('visible');
        }
    });
};
window.addEventListener('scroll', revealCards);
window.addEventListener('load', revealCards);
</script>
